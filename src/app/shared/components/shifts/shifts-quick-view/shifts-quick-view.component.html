<!-- Enhanced Mobile-First Shift Quick View (Trips Style, with border and alternating color) -->
<div class="bg-white rounded-xl mb-4 overflow-hidden shadow transition-shadow shadow-sm hover:shadow-md"
  [ngClass]="{
    'opacity-60 bg-gray-50': shift.action === ActionEnum.Delete,
    'shift-border-saved': shift.saved,
    'shift-border-add': !shift.saved && shift.action === ActionEnum.Add,
    'shift-border-update': !shift.saved && shift.action === ActionEnum.Update,
    'shift-border-delete': !shift.saved && shift.action === ActionEnum.Delete,
    'shift-border-other': !shift.saved && (!shift.action || (shift.action !== ActionEnum.Add && shift.action !== ActionEnum.Update && shift.action !== ActionEnum.Delete)),
    'bg-gradient-to-r from-blue-50 to-white': shift.rowId % 2 === 0 && shift.action !== ActionEnum.Delete,
    'bg-gradient-to-r from-green-50 to-white': shift.rowId % 2 === 1 && shift.action !== ActionEnum.Delete
  }">
  <!-- Header Row -->
  <div class="p-3 border-b"
    [ngClass]="{
      'bg-blue-100 border-blue-300': shift.rowId % 2 === 0,
      'bg-green-100 border-green-300': shift.rowId % 2 === 1
    }">
    <div class="flex items-center gap-2 sm:gap-4 min-w-0 w-full overflow-x-auto">
      <!-- Status Icon -->
      <mat-icon class="text-xl flex-shrink-0"
        [ngClass]="{
          'text-gray-400': shift.saved && !duplicateShift,
          'text-green-500': !shift.saved && shift.action === ActionEnum.Add && !duplicateShift,
          'text-blue-500': !shift.saved && shift.action === ActionEnum.Update && !duplicateShift,
          'text-red-500': (!shift.saved && shift.action === ActionEnum.Delete && !duplicateShift),
          'text-yellow-500': !shift.saved && (!shift.action || (shift.action !== ActionEnum.Add && shift.action !== ActionEnum.Update && shift.action !== ActionEnum.Delete) && !duplicateShift),
          'text-orange-500': duplicateShift
        }">
        @if (!shift.saved && shift.action === ActionEnum.Add && !duplicateShift) { add }
        @else if (!shift.saved && shift.action === ActionEnum.Update && !duplicateShift) { edit }
        @else if (!shift.saved && shift.action === ActionEnum.Delete && !duplicateShift) { delete }
        @else if (duplicateShift) { content_copy }
        @else { check_circle }
      </mat-icon>
      <!-- Row ID -->
      <span class="text-xs font-bold text-gray-700 font-mono flex-shrink-0">#{{shift.rowId}}</span>
      <!-- Service Name, Number (flexible, grows) -->
      <span class="font-bold text-gray-900 text-sm sm:text-base flex-1 min-w-0 inline-flex items-center">
        <span class="truncate block">{{shift.service}}</span><span *ngIf="shift.number > 0">&nbsp;#{{shift.number}}</span>
      </span>
      <!-- Date (centered, before total) -->
      <span class="mx-auto text-xs text-gray-500 font-mono flex-shrink-0 text-center" *ngIf="shift.date">{{ shift.date | date:'EEE, MMM d' }}</span>
      <!-- Total (far right) -->
      <span class="flex items-center gap-1 flex-shrink-0 justify-end">
        <mat-icon [ngClass]="{
          'text-blue-400': shift.action !== ActionEnum.Delete,
          'text-gray-400': shift.action === ActionEnum.Delete
        }" class="text-base">payments</mat-icon>
        <span class="font-bold text-sm sm:text-base"
              [ngClass]="{
                'text-gray-400': !shift.grandTotal,
                'text-green-600': shift.amountPerTime > 30,
                'text-blue-600': shift.amountPerTime >= 25 && shift.amountPerTime <= 30,
                'text-yellow-600': shift.amountPerTime >= 20 && shift.amountPerTime < 25,
                'text-red-500': shift.amountPerTime < 20
              }">
          {{shift.grandTotal ? (shift.grandTotal | currency) : '$0.00'}}
        </span>
      </span>
    </div>
    <!-- Time Row: start - finish (left), duration (right) -->
    <div class="flex items-center mt-1 text-sm text-gray-700 w-full">
      <span *ngIf="shift.start" class="flex items-center gap-1 flex-1 justify-start">
        <mat-icon class="text-gray-400 text-base">schedule</mat-icon>
        <span class="font-mono font-medium whitespace-nowrap truncate">{{ shift.start | noseconds:prefers24Hour }}<span *ngIf="shift.finish">-{{ shift.finish | noseconds:prefers24Hour }}</span></span>
      </span>
      <span *ngIf="shift.totalTime" class="flex items-center gap-1 flex-1 justify-end">
        <mat-icon class="text-gray-400 text-base">hourglass_bottom</mat-icon>
        <span class="font-mono whitespace-nowrap truncate">{{shift.totalTime | durationFormat}} total</span>
      </span>
    </div>
    <!-- Divider for visual separation -->
    <div class="my-2 border-t border-gray-200"></div>
    <!-- Info Row: trips (left), distance (center), active (right) -->
    <div class="mt-1 text-xs text-gray-600 truncate text-center flex items-center w-full relative">
      <span *ngIf="shift.totalTrips" class="flex items-center gap-1 flex-1 justify-start">
        <mat-icon class="text-blue-400 text-base">route</mat-icon>
        <span class="font-mono text-xs text-gray-700">{{shift.totalTrips}} trips</span>
      </span>
      <span *ngIf="shift.totalDistance" class="flex items-center gap-1 flex-1 justify-center">
        <mat-icon class="text-blue-400 text-base">straighten</mat-icon>
        <span class="font-mono text-xs text-gray-700">{{formatDistance(shift.totalDistance)}}</span>
      </span>
      <span *ngIf="shift.totalActive" class="flex items-center gap-1 flex-1 justify-end">
        <mat-icon class="text-gray-400 text-base">directions_car</mat-icon>
        <span class="font-mono text-xs text-gray-700">{{shift.totalActive | durationFormat}} active</span>
      </span>
    </div>
    <!-- Toggle Button Bar -->
    <div class="focus-within:ring-0 focus-within:outline-none mt-2">
      <button class="w-full flex items-center justify-center gap-2 py-1 text-xs text-gray-400 hover:text-blue-500 transition-colors bg-transparent font-medium outline-none ring-0 focus:outline-none focus:ring-0 border-0 shadow-none"
              (click)="toggleExpansion()" 
              tabindex="0" 
              [attr.aria-label]="isExpanded ? 'Hide details' : 'Show details'"
              [title]="isExpanded ? 'Hide details' : 'Show details'"
              (keydown.enter)="toggleExpansion()" 
              (keydown.space)="toggleExpansion()"
              [attr.aria-expanded]="isExpanded">
        <span class="flex-1 h-px bg-gray-400"></span>
        <mat-icon class="text-base">{{isExpanded ? 'expand_less' : 'expand_more'}}</mat-icon>
        <span class="font-normal">{{isExpanded ? 'Less' : 'More'}} Details</span>
        <span class="flex-1 h-px bg-gray-400"></span>
      </button>
    </div>
  </div>
  <!-- Details Section -->
  <div class="p-3 bg-gray-50 border-t" *ngIf="isExpanded">
    <!-- Region Row (moved from summary) -->
    <div *ngIf="shift.region" class="mb-4">
      <span class="inline-block px-3 py-1 rounded bg-gray-100 text-sm text-gray-700 border border-gray-200 font-medium max-w-full truncate" title="{{shift.region}}">
        <mat-icon class="text-gray-400 text-base mr-1 align-middle">public</mat-icon>
        {{shift.region}}
      </span>
    </div>
    <!-- Quick Stats Row (remove finish time and duration badges) -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4" *ngIf="shift.amountPerTime || (shift.grandTotal && shift.totalDistance)">
      <div *ngIf="shift.amountPerTime" class="text-center p-2 bg-white rounded-lg border">
        <div class="text-xs text-gray-500 mb-1">Rate/Hr</div>
        <div class="text-sm font-bold text-green-600">${{shift.amountPerTime | number:'1.2-2'}}</div>
      </div>
      <div *ngIf="shift.grandTotal && shift.totalDistance" class="text-center p-2 bg-white rounded-lg border">
        <div class="text-xs text-gray-500 mb-1">Rate/Mile</div>
        <div class="text-sm font-bold text-blue-600">${{(shift.grandTotal / shift.totalDistance) | number:'1.2-2'}}</div>
      </div>
    </div>
    <!-- Payment Breakdown -->
    <div class="mb-4" *ngIf="shift.totalPay || shift.totalTips || shift.totalBonus || shift.totalCash">
      <h3 class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
        <mat-icon class="text-blue-400 text-base">payments</mat-icon>
        Payment Details
      </h3>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
        <div *ngIf="shift.totalPay" class="flex justify-between p-2 bg-white rounded border">
          <span class="text-xs text-gray-600">Pay</span>
          <span class="text-sm font-bold">{{shift.totalPay | currency}}</span>
        </div>
        <div *ngIf="shift.totalTips" class="flex justify-between p-2 bg-white rounded border">
          <span class="text-xs text-gray-600">Tip</span>
          <span class="text-sm font-bold">{{shift.totalTips | currency}}</span>
        </div>
        <div *ngIf="shift.totalBonus" class="flex justify-between p-2 bg-white rounded border">
          <span class="text-xs text-gray-600">Bonus</span>
          <span class="text-sm font-bold">{{shift.totalBonus | currency}}</span>
        </div>
        <div *ngIf="shift.totalCash" class="flex justify-between p-2 bg-white rounded border">
          <span class="text-xs text-gray-600">Cash</span>
          <span class="text-sm font-bold">{{shift.totalCash | currency}}</span>
        </div>
      </div>
      <div *ngIf="shift.grandTotal" class="mt-2 p-2 bg-green-50 rounded border border-green-200">
        <div class="flex justify-between items-center">
          <span class="text-sm font-semibold text-green-700">Total</span>
          <span class="text-lg font-bold text-green-700">{{shift.grandTotal | currency}}</span>
        </div>
      </div>
    </div>
    <!-- Note -->
    <div *ngIf="shift.note" class="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
      <h3 class="text-sm font-semibold text-yellow-800 mb-2 flex items-center gap-2">
        <mat-icon class="text-yellow-600 text-base">format_quote</mat-icon>
        Note
      </h3>
      <p class="text-sm text-yellow-700 italic">{{shift.note}}</p>
    </div>
    <!-- Trips Table -->
    <div>
      <app-shift-trips-table [tripKey]="shift.key"></app-shift-trips-table>
    </div>
  </div>
  <!-- Action Bar -->
  <div class="flex items-center justify-between p-3 border-t"
    [ngClass]="{
      'bg-blue-100 border-blue-300': shift.rowId % 2 === 0,
      'bg-green-100 border-green-300': shift.rowId % 2 === 1
    }">
    <!-- Edit Button -->
    <button class="flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium transition"
      (click)="editShift()" 
      [disabled]="!canEditShift()"
      [class.cursor-not-allowed]="!canEditShift()"
      [class.opacity-50]="!canEditShift()"
      [class.grayscale]="!canEditShift()"
      [attr.aria-label]="'Edit shift'"
      [attr.title]="'Edit shift'">
      <mat-icon class="text-blue-500 text-base">edit</mat-icon>
      <span class="hidden sm:inline">Edit</span>
    </button>
    <!-- Center Action Buttons (none for now) -->
    <div class="flex gap-2"></div>
    <!-- Delete Button -->
    <button class="flex items-center gap-2 px-3 py-2 bg-red-50 text-red-700 border border-red-200 rounded-lg text-sm font-medium transition"
      [class.cursor-not-allowed]="!canDeleteShift()"
      [class.opacity-50]="!canDeleteShift()"
      [class.grayscale]="!canDeleteShift()"
      [disabled]="!canDeleteShift()"
      (click)="confirmDeleteShiftDialog(shift)">
      <mat-icon class="text-red-500 text-base">delete</mat-icon>
      <span class="hidden sm:inline">Delete</span>
    </button>
  </div>
</div>