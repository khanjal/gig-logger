<mat-card>
    <div>
        <mat-card-header>
            @if (!trip.saved && trip.action === 'ADD') {
                <mat-icon class="warn">add</mat-icon> 
            }
            @else if (!trip.saved && trip.action === 'UPDATE') {
                <mat-icon class="warn">edit</mat-icon>
            }
            @else if (!trip.saved && trip.action === 'DELETE') {
                <mat-icon class="warn">delete</mat-icon> 
            }
            @else {
                <mat-icon [ngClass]="{'warn': !trip.saved}">save</mat-icon> 
            }
            <h3><strong>#{{trip.rowId}} {{trip.date | date:'MMM d'}}, {{trip.pickupTime | noseconds}} ({{trip.service}} {{ trip.number == 0 ? "" : '#' + trip.number }})</strong></h3>
        </mat-card-header>
        <mat-card-content [ngClass]="trip.exclude || trip.action === 'DELETE' ? 'strike' : ''">
            <div class="row-flex section-container">
                <div>
                    <mat-icon class="icon-display">schedule</mat-icon>
                </div>  
                <div class="padding-left">
                    <div><strong>{{ trip.type === "" ? "Time" : trip.type }}:</strong>&nbsp;<span [ngClass]="{'primary': trip.amountPerTime > 25, 'warn': trip.amountPerTime < 20, 'rainbow-text-animated': trip.amountPerTime > 30}">{{trip.pickupTime | noseconds}} {{!trip.duration ? '' : '- ' + (trip.dropoffTime | noseconds)}}</span></div>
                    <div *ngIf="trip.duration"><strong>Duration:</strong> {{trip.duration | noseconds}}</div>
                </div>
            </div>
            @if (trip.region || trip.distance) {
                <div class="row-flex section-container">
                    <div>
                        <mat-icon class="icon-display">map</mat-icon>
                    </div>  
                    <div class="padding-left">
                        <div *ngIf="trip.region">{{trip.region}}</div>
                        <div *ngIf="trip.startOdometer || trip.distance">
                            <strong>Distance:</strong> {{trip.startOdometer | number}}<span *ngIf="trip.endOdometer"> - {{trip.endOdometer | number}}</span>
                            <span *ngIf="trip.distance"> (<span [ngClass]="{'primary': trip.amountPerDistance > 2, 'warn': trip.amountPerDistance < 1, 'rainbow-text-animated': trip.amountPerDistance > 5}">{{trip.distance | number:'1.1'}}</span>)</span>
                        </div>
                    </div>
                </div>
            }

            @if (trip.place || trip.startAddress) {
                <div class="row-flex section-container">
                    <div>
                        <mat-icon class="icon-display">storefront</mat-icon>
                    </div>
                    <div class="padding-left">
                        <strong>{{trip.place}}</strong> 
                        <br/>
                        {{ trip.startAddress | shortaddress:trip.place | truncate:40}}
                    </div>
                </div>
            }
            
            @if (trip.name || trip.endAddress) {
                <div class="row-flex section-container">
                    <div>
                        <mat-icon class="icon-display">home</mat-icon>
                    </div>
                    <div class="padding-left">
                        <strong>{{trip.name | truncate:25}}</strong> 
                        <br/>
                        {{ trip.endAddress | shortaddress | truncate:40}}
                    </div>
                </div>
            }
            
            @if (trip.pay || trip.total) {
                <div class="row-flex section-container">
                    <div>
                        <mat-icon class="icon-display">payments</mat-icon>
                    </div>
                    <div class="padding-left">
                        <span class="padding-right" *ngIf="trip.pay"><strong>Pay</strong> {{trip.pay | currency}}</span> 
                        <span class="padding-right" *ngIf="trip.tip"><strong>Tip</strong> {{trip.tip | currency}}</span> 
                        <span class="padding-right" *ngIf="trip.bonus"><strong>Bonus</strong> {{trip.bonus | currency}}</span> 
                        <br/>
                        <span class="padding-right" *ngIf="trip.total > trip.pay"><strong>Total</strong> {{trip.total | currency}}</span>
                        <span class="padding-right" *ngIf="trip.cash"><strong>Cash</strong> {{trip.cash | currency}}</span>
                    </div>
                </div>
            }
            
            @if (trip.endUnit || trip.orderNumber || trip.note) {
                <div class="row-flex section-container">
                    <div>
                        <mat-icon class="icon-display">description</mat-icon>
                    </div>
                    <div class="padding-left">
                        <div>
                            <span class="padding-right" *ngIf="trip.endUnit"><strong>Unit #</strong> {{trip.endUnit}}</span> 
                            <span *ngIf="trip.orderNumber"><strong>Order #</strong> {{trip.orderNumber}}</span>
                        </div>
                        <div *ngIf="trip.note">"{{trip.note}}"</div>
                    </div>
                </div>
            }
            
        </mat-card-content>
    </div>
    <div mat-card class="row-flex button-bar" *ngIf="showActions">
        <button mat-fab extended color="primary" class="button-left" (click)="openTripDialog()"><mat-icon>edit</mat-icon> Edit</button>
        <button mat-fab extended color="accent" (click)="setPickupTime()" *ngIf="!trip.pickupTime && !trip.dropoffTime && !trip.exclude"><mat-icon>update</mat-icon> Pickup</button>
        <button mat-fab extended color="accent" (click)="setDropoffTime()" *ngIf="trip.pickupTime && !trip.dropoffTime && !trip.exclude"><mat-icon>schedule</mat-icon> Dropoff</button>
        <button mat-fab color="primary" [matMenuTriggerFor]="menu" aria-label="Trip menu">
            <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu color="primary" #menu="matMenu">
            <!-- <button mat-menu-item>
                <mat-icon>block</mat-icon>
                <span>Exclude</span>
            </button> -->
            <button mat-menu-item (click)="nextUnsavedTrip()">
                <mat-icon>pin_drop</mat-icon>
                <span>Next</span>
            </button>
            <button mat-menu-item (click)="cloneUnsavedTrip()">
                <mat-icon>content_copy</mat-icon>
                <span>Clone</span>
            </button>
            @if (trip.action != actionEnum.Delete) {
                <button mat-menu-item [attr.color]="'warn'" (click)="confirmDeleteTripDialog()">
                    <mat-icon color="warn">delete</mat-icon>
                    <span>Delete</span>
                </button>
            }
            @else {
                <button mat-menu-item [attr.color]="'primary'" (click)="restoreTrip()">
                    <mat-icon color="primary">restore</mat-icon>
                    <span>Restore</span>
                </button>
            }
        </mat-menu>
    </div>
</mat-card>
