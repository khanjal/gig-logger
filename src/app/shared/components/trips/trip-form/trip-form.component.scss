@import "color-vars";

// Mobile-first trip form with PWA-optimized touch targets
.trip-form {
    margin-bottom: 1rem;
    min-width: 100px;
    width: 100%;
    padding: 0.5rem;
    
    // Mobile-first form styling
    @media (max-width: 480px) {
        padding: 0.25rem;
    }
}

// Touch-friendly field buttons
.field-button {
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
    min-height: 44px; // Touch target minimum
    min-width: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    
    @media (max-width: 768px) {
        margin-right: 0.25rem;
        margin-bottom: 0.75rem;
        flex: 1;
        max-width: calc(50% - 0.125rem);
    }
    
    @media (max-width: 480px) {
        max-width: 100%;
        margin-right: 0;
    }
}

.bold {
    font-weight: 600; // Slightly bolder for mobile readability
}

.button-icon {
    margin-top: 0.5rem;
    
    @media (max-width: 768px) {
        margin-top: 0.25rem;
    }
}

// Enhanced tabbed content for mobile
.tab {
    margin-left: 1rem;
    padding: 0.5rem 0;
    
    .title {
        font-weight: 600;
        padding-bottom: 0.75rem;
        font-size: 1.1rem;
        color: $primary-color;
        
        @media (max-width: 768px) {
            font-size: 1rem;
            padding-bottom: 0.5rem;
        }
    }

    .sub-tab { 
        margin-left: 0.5rem;
        padding: 0.25rem 0;
    }
    
    @media (max-width: 768px) {
        margin-left: 0.5rem;
        padding: 0.25rem 0;
    }
    
    @media (max-width: 480px) {
        margin-left: 0.25rem;
    }
}

.tab-itallic {
    font-style: italic;
    margin-left: 0.5rem;
    color: $text-secondary;
    
    @media (max-width: 768px) {
        margin-left: 0.25rem;
        font-size: 0.9rem;
    }
}

.highlight {
    color: $accent-color !important;
    font-weight: 500;
}

// Enhanced icon buttons for mobile
.mat-icon-button {
    margin: 0;
    min-height: 44px;
    min-width: 44px;
    
    @media (max-width: 768px) {
        &:not(:last-child) {
            margin-right: 0.5rem;
        }
    }
}

.margin-right {
    margin-right: 1rem;
    
    @media (max-width: 768px) {
        margin-right: 0.5rem;
    }
    
    @media (max-width: 480px) {
        margin-right: 0.25rem;
    }
}

// Mobile-optimized virtual scroll
cdk-virtual-scroll-viewport {
    height: 200px;
    border-radius: 8px;
    border: 1px solid $border-color;
    
    @media (max-width: 768px) {
        height: 150px;
        border-radius: 6px;
    }
    
    @media (max-width: 480px) {
        height: 120px;
        border-radius: 4px;
    }
}

// Enhanced address selection for mobile
.selected-name-address {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: linear-gradient(135deg, $primary-50 0%, $secondary-50 100%);
    border-radius: 12px;
    border: 1px solid $border-light;
    
    @media (max-width: 768px) {
        margin-bottom: 1rem;
        padding: 0.75rem;
        border-radius: 8px;
    }
    
    @media (max-width: 480px) {
        margin-bottom: 0.75rem;
        padding: 0.5rem;
        border-radius: 6px;
    }
}

// Component-specific styling that extends global utilities
.form-header {
    margin-bottom: 1.5rem;
    
    h1 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 500;
        color: var(--primary-color);
        
        @media (max-width: 768px) {
            font-size: 1.25rem;
        }
    }
}

.form-section {
    margin-bottom: 0rem;
}

// Component-specific styling that doesn't use global utilities
.delivery-item {
    margin-bottom: 1rem;
    padding: 0.75rem;
    border-radius: 4px;
    background: rgba(0, 0, 0, 0.02);
    
    &:last-child {
        margin-bottom: 0;
    }
}

.delivery-title {
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
}

.address-button,
.name-button {
    width: 100%;
    margin-bottom: 0.5rem;
    text-align: left;
    justify-content: flex-start;
    
    &--selected {
        background-color: var(--accent-color);
        color: white;
    }
}

.trips-table {
    margin-top: 0.5rem;
}

// Mobile-specific adjustments for Material expansion panels
@media (max-width: 768px) {
    ::ng-deep {
        .mat-expansion-panel-body {
            padding: 0.75rem 1rem;
        }
        
        .mat-expansion-panel-header {
            padding: 0 1rem;
            height: 48px;
        }
    }
}

@media (max-width: 480px) {
    ::ng-deep {
        .mat-expansion-panel-body {
            padding: 0.5rem 0.75rem;
        }
        
        .mat-expansion-panel-header {
            padding: 0 0.75rem;
            height: 44px;
        }
        
        .mat-mdc-fab.mat-mdc-mini-fab {
            width: 40px;
            height: 40px;
        }
    }
}

// Address lists
.address-list {
    margin: 1rem 0;
    
    mat-expansion-panel {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
}

.address-options {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0.5rem 0;
}

// Custom styling for form rows with buttons - ensures proper field width adjustment
.form-row {
    &:has(.toggle-button) {
        .field-full-width {
            flex: 1;
            margin-right: 0.75rem;
            
            @media (max-width: 768px) {
                margin-right: 0.5rem;
            }
        }
        
        .toggle-button {
            flex-shrink: 0;
        }
    }
}

// Alternative approach using direct styling for better browser support
.form-row {
    .field-full-width + .toggle-button {
        margin-left: 0.75rem;
        
        @media (max-width: 768px) {
            margin-left: 0.5rem;
        }
    }
}

// Fallback approach for browsers that don't support :has() selector
.form-row {
    // Direct child selector approach for better browser support
    > .field-full-width:not(:only-child) {
        @media (max-width: 768px) {
            flex: 1;
            width: auto;
            max-width: none;
        }
    }
    
    > app-search-input.field-full-width:not(:only-child) {
        @media (max-width: 768px) {
            flex: 1;
            width: auto;
            max-width: none;
            min-width: 0;
        }
    }
    
    // Ensure toggle buttons don't grow
    > .toggle-button {
        @media (max-width: 768px) {
            flex-shrink: 0;
            width: 44px;
            height: 44px;
        }
        
        @media (max-width: 480px) {
            width: 40px;
            height: 40px;
        }
    }
}

// Specific styling for the customer information section name field
.form-section:nth-child(4) { // Customer Information section
    .form-row {
        @media (max-width: 768px) {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            
            app-search-input.field-full-width {
                flex: 1;
                width: auto !important;
                max-width: none !important;
                min-width: 0;
            }
            
            .toggle-button {
                flex-shrink: 0;
                margin-left: 0;
            }
        }
        
        @media (max-width: 480px) {
            gap: 0.375rem;
        }
    }
}

// Mobile responsive form field behavior
@media (max-width: 768px) {
    // All form fields should be full width on mobile unless they're in specific multi-field rows
    .form-row:not(.form-row--halves):not(.form-row--thirds) {
        .form-field {
            width: 100%;
            max-width: 100%;
            flex: 1 1 100%;
        }
        
        mat-form-field {
            width: 100%;
            max-width: 100%;
            flex: 1 1 100%;
        }
        
        app-search-input {
            width: 100%;
            max-width: 100%;
            flex: 1 1 100%;
        }
        
        .field-full-width {
            width: 100%;
            max-width: 100%;
            flex: 1 1 100%;
        }
    }
    
    // Form rows with buttons should keep fields and buttons on same row
    .form-row:has(.toggle-button) {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 0.5rem;
        
        .field-full-width,
        app-search-input {
            flex: 1;
            width: auto;
            max-width: none;
        }
        
        .toggle-button {
            flex-shrink: 0;
            width: 44px;
            height: 44px;
        }
    }
    
    // Special handling for Payment section with button-first layout
    .form-row {
        &:first-child .toggle-button:first-child {
            order: -1; // Ensure button appears first
            margin-right: 0.5rem;
        }
        
        // When button is first, following fields should share remaining space
        .toggle-button + .form-field {
            flex: 1;
            min-width: 0;
        }
        
        .form-field + .form-field {
            flex: 1;
            min-width: 0;
        }
    }
    
    // Halves layout - two fields side by side on mobile
    .form-row--halves {
        display: flex;
        gap: 0.5rem;
        
        .form-field {
            flex: 1;
            width: calc(50% - 0.25rem);
            max-width: calc(50% - 0.25rem);
        }
    }
    
    // Thirds layout - three fields side by side on mobile with adjusted widths
    .form-row--thirds {
        display: flex;
        gap: 0.25rem;
        
        .form-field {
            flex: 1;
            width: calc(33.333% - 0.17rem);
            max-width: calc(33.333% - 0.17rem);
            min-width: 70px;
        }
    }
    
    // Target search-input components specifically for full width behavior
    app-search-input {
        width: 100% !important;
        display: block !important;
        
        &.field-full-width {
            flex: 1 !important;
            max-width: none !important;
            min-width: 0 !important;
        }
    }
    
    // Ensure form rows with single search-input fields use full width
    .form-row:not(.form-row--halves):not(.form-row--thirds) {
        app-search-input {
            width: 100% !important;
            flex: 1 1 100% !important;
        }
    }
    
    // Special handling for Service, Region, Place, Type fields
    .form-row app-search-input[formControlName="service"],
    .form-row app-search-input[formControlName="region"], 
    .form-row app-search-input[formControlName="place"],
    .form-row app-search-input[formControlName="type"] {
        width: 100% !important;
        max-width: 100% !important;
        flex: 1 1 100% !important;
        display: block !important;
    }
}

@media (max-width: 480px) {
    // Even more compact on small mobile screens
    .form-row:has(.toggle-button) {
        gap: 0.375rem;
        
        .toggle-button {
            width: 40px;
            height: 40px;
            
            mat-icon {
                font-size: 18px;
            }
        }
    }
    
    // Adjust thirds layout for very small screens
    .form-row--thirds {
        gap: 0.125rem;
        
        .form-field {
            width: calc(33.333% - 0.08rem);
            max-width: calc(33.333% - 0.08rem);
            min-width: 60px;
            
            ::ng-deep .mat-mdc-form-field {
                .mat-mdc-form-field-infix {
                    padding: 8px 0;
                }
            }
        }
    }
    
    // Ensure single fields with buttons are truly full width
    .form-row {
        &:not(.form-row--halves):not(.form-row--thirds) {
            .field-full-width,
            app-search-input {
                width: 100% !important;
                max-width: none !important;
                flex: 1 !important;
            }
        }
        
        // Special handling for name field specifically
        app-search-input.field-full-width {
            width: 100% !important;
            flex: 1 !important;
            min-width: 0 !important;
        }
    }
    
    app-search-input {
        width: 100% !important;
        max-width: 100% !important;
        
        &.field-full-width {
            width: 100% !important;
            flex: 1 !important;
        }
    }
}

// ::-webkit-scrollbar {
//     width: 10px;
// }

// ::-webkit-scrollbar-track {
//     background: transparent;
// }

// ::-webkit-scrollbar-thumb {
//     background: transparent;
// }