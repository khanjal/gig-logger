<div class="page-container container flex flex-col min-h-screen md:p-8 lg:p-12 text-gray-800 dark:text-gray-200">
  <h1 class="text-3xl font-bold">Setup</h1>

  <div class="mb-6">
    <app-login></app-login>
  </div>

  <ng-container *ngIf="isAuthenticated">
    <div class="mb-6" *ngIf="!spreadsheets?.length">
      <h2 class="text-2xl font-semibold text-primary dark:text-primary">Set Up Your Spreadsheet</h2>
      <app-sheet-link (parentReload)="reload()"></app-sheet-link>
      <app-sheet-demo (parentReload)="reload()"></app-sheet-demo>
    </div>

    <app-base-card title="Current Spreadsheets" variant="default" padding="md" class="mb-6" *ngIf="spreadsheets?.length">
      <div *ngFor="let spreadsheet of spreadsheets" class="mb-4">
        <app-sheet-quick-view [spreadsheet]="spreadsheet"></app-sheet-quick-view>
        <div class="flex flex-row justify-between items-center gap-2 mt-2">
          <app-base-button variant="primary" [icon]="'refresh'" [loading]="reloading" [disabled]="reloading || unsavedData" (clicked)="reload()" *ngIf="spreadsheet.default === 'true'">
            Reload Data
          </app-base-button>
          <app-base-button variant="primary" [icon]="'schedule'" [loading]="setting" [disabled]="setting || reloading || unsavedData" (clicked)="setDefault(spreadsheet)" *ngIf="spreadsheet.default === 'false'">
            Set Default
          </app-base-button>
          <app-base-button variant="danger" [icon]="'link_off'" [loading]="deleting" [disabled]="deleting || reloading || unsavedData" (clicked)="confirmUnlinkSpreadsheetDialog(spreadsheet)">
            Unlink
          </app-base-button>
        </div>
        <div *ngIf="unsavedData" class="mt-2 text-sm text-orange-600 dark:text-orange-400 flex items-start gap-2 py-1">
          <mat-icon class="!text-base !w-5 !h-5 !leading-5 flex-shrink-0">warning</mat-icon>
          <span class="flex-1">Actions disabled due to unsaved changes. Use the <strong>Refresh Data</strong> or <strong>Delete Data</strong> buttons at the bottom to override (you will lose unsaved changes).</span>
        </div>
      </div>
    </app-base-card>

    <!-- Advanced Settings Toggle -->
    <div class="mb-6" *ngIf="spreadsheets?.length">
      <app-base-button 
        [variant]="showAdvanced ? 'primary' : 'secondary'"
        [icon]="showAdvanced ? 'expand_less' : 'expand_more'"
        [fullWidth]="true"
        (clicked)="showAdvanced = !showAdvanced">
        {{ showAdvanced ? 'Hide' : 'Show' }} Advanced Settings
      </app-base-button>
    </div>
  </ng-container>

  <div class="mb-6 bg-surface text-gray-800 dark:text-gray-200 rounded-lg shadow-sm border border-soft" *ngIf="showAdvanced">
    <app-permissions></app-permissions>
  </div>

  <div class="mb-6" *ngIf="showAdvanced">
    <app-mock-location></app-mock-location>
  </div>

  <app-base-card title="Application Insights" variant="default" padding="md" class="mb-6" *ngIf="showAdvanced">
    <div class="mb-2 text-primary dark:text-primary">Version: <strong>{{ version }}</strong></div>
    <app-sheet-quota></app-sheet-quota>
    <app-service-worker-status></app-service-worker-status>
  </app-base-card>

  <div class="mb-6 bg-surface text-gray-800 dark:text-gray-200 rounded-lg shadow-sm border border-soft" *ngIf="showAdvanced">
    <app-auth-status></app-auth-status>
  </div>

  <div class="mb-6" *ngIf="showAdvanced">
    <div class="flex flex-row justify-between items-center gap-2">
      <app-base-button variant="primary" [icon]="'refresh'" [loading]="deleting" [disabled]="deleting" (clicked)="confirmDeleteAndReloadDialog()" *ngIf="spreadsheets?.length">
        Refresh Data
      </app-base-button>
      <app-base-button variant="danger" [icon]="'delete'" [loading]="deleting" [disabled]="deleting" (clicked)="confirmDeleteAllDialog()">
        Delete Data
      </app-base-button>
    </div>
  </div>
</div>